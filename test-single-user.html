<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single User Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Single User Creation Test</h1>
        <p>This page tests creating a single user to diagnose issues.</p>

        <div class="card mb-4">
            <div class="card-body">
                <h5>Test User Data</h5>
                <pre id="userData"></pre>
                <button class="btn btn-jira-primary" onclick="testCreateUser()">Create Test User</button>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Results</div>
            <div class="card-body">
                <pre id="results" style="max-height: 400px; overflow-y: auto;"></pre>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>

    <script>
        const testUser = {
            name: `Test User ${Date.now()}`,
            email: `test.user.${Date.now()}@example.com`,
            password: 'Password123!',
            role: 'Viewer',
            status: 'active'
        };

        document.getElementById('userData').textContent = JSON.stringify(testUser, null, 2);

        async function testCreateUser() {
            const resultsEl = document.getElementById('results');
            resultsEl.textContent = 'Testing...\n';

            // Check auth
            if (!AuthService.isAuthenticated()) {
                resultsEl.textContent += 'ERROR: Not authenticated!\n';
                resultsEl.textContent += 'Please login at index.html first.\n';
                return;
            }

            resultsEl.textContent += `✓ Authenticated\n`;
            resultsEl.textContent += `Token: ${AuthService.getToken().substring(0, 20)}...\n\n`;

            // Test API endpoint
            resultsEl.textContent += `Testing API endpoint...\n`;

            try {
                const response = await ApiService.createUser(testUser);
                resultsEl.textContent += `\n✓ SUCCESS!\n\n`;
                resultsEl.textContent += `Response:\n${JSON.stringify(response, null, 2)}\n`;
            } catch (error) {
                resultsEl.textContent += `\n✗ FAILED!\n\n`;
                resultsEl.textContent += `Error: ${error.message}\n`;
                resultsEl.textContent += `\nFull error:\n${JSON.stringify(error, null, 2)}\n`;
            }
        }

        // Check auth on load
        window.onload = () => {
            if (!AuthService.isAuthenticated()) {
                alert('Please login first at index.html');
            }
        };
    </script>
</body>
</html>
